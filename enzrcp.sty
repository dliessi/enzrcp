\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{enzrcp}[2013/08/11 v0.4 Typeset recipes for enzyme reactions]

\RequirePackage{float}[2001/11/08]
\RequirePackage{booktabs}[2005/04/14]
\RequirePackage{siunitx}[2012/12/29]
\RequirePackage{schemata}[2013/03/10]


\makeatletter
\newcommand\fs@plaintopbf{\fs@plaintop
\def\@fs@cfont{\sffamily\bfseries}}
\let\floatc@plaintop=\floatc@plain
\let\float@captionold\caption
\renewcommand{\caption}[1]{\float@captionold{\textsf{#1}}}
\makeatother

\floatstyle{plaintopbf}
\newfloat{Recipe}{tbp}{rcp}


\sisetup{detect-family}

\makeatletter
\newcommand{\enzrcp@recipewidth}{0.9\textwidth}
\newcommand{\enzrcp@ingredwidth}{0.45\textwidth}
\newcommand{\enzrcp@ingrednamewidth}{0.5\textwidth}
\newcommand{\enzrcp@ingredspacewidth}{0.5em}
\newcommand{\enzrcp@instrwidth}{0.5\textwidth}
\makeatother

\newcommand{\NB}{\textbf{N.B.} }


\newcommand{\ingred}[3]{#1&#2&\si{#3}\\}

\makeatletter
\newcommand{\recipe}[5][]{%
\begin{Recipe}[H]
\caption{#3}
\label{rcp:#2}
\medskip
\centering
\begin{minipage}[t]{\enzrcp@recipewidth}
\sffamily
\begin{minipage}[c]{\enzrcp@ingredwidth}
\begin{tabular}{p{\enzrcp@ingrednamewidth}@{\hspace{\enzrcp@ingredspacewidth}}S@{}s}
\toprule
#4
\bottomrule
\end{tabular}
\end{minipage}
\hfill
\begin{minipage}[c]{\enzrcp@instrwidth}
#5
\end{minipage}
\smallskip
\if\relax\detokenize{#1}\relax\else\par\smallskip\NB#1\fi
\end{minipage}
\end{Recipe}}
\makeatother


\newcommand{\enzrcp}[6][]{%
\recipe[#1]{#2}{#3}{#4}{%
\if\relax\detokenize{#5}\relax\else\textbf{Incubation:} #5\fi

\smallskip
\if\relax\detokenize{#6}\relax\else\textbf{Inactivation:} #6\fi}}


\newcommand{\enzrcpTemp}[1]{\SI{#1}{\degreeCelsius}}
\newcommand{\enzrcpTime}[2]{\if\relax\detokenize{#1}\relax\else\SI{#1}{\arcminute}\fi%
\if\relax\detokenize{#2}\relax\else\SI{#2}{\arcsecond}\fi}
\newcommand{\enzrcpTimeTemp}[3]{\enzrcpTime{#1}{#2}~@~\enzrcpTemp{#3}}


\newcommand{\PCR}[9][]{%
\def\enzrcpNB{#1}%\if\relax\detokenize{#1}\relax\else\par\smallskip\NB#1\fi}%
\def\enzrcpID{#2}%
\def\enzrcpCaption{#3}%
\def\enzrcpIngred{#4}%
\def\enzrcpMeltingInitial{#5}%
\def\enzrcpCycle{#6 $\times$}
\def\enzrcpMeltingCycle{#7}%
\def\enzrcpAnnealing{#8}%
\def\enzrcpElongationCycle{#9}%
\PCRcontinuedA%
}

\newcommand{\PCRcontinuedA}[2]{%
\def\enzrcpElongationFinal{#1}%
\def\enzrcpStorage{\enzrcpTemp{#2}~$\infty$}%
\recipe[\enzrcpNB]{\enzrcpID}{\enzrcpCaption}{\enzrcpIngred}{%
\textbf{Melting:} \enzrcpMeltingInitial

\schema{\schemabox{\enzrcpCycle}}{\schemabox{%
\textbf{Melting:} \enzrcpMeltingCycle\\
\textbf{Annealing:} \enzrcpAnnealing\\
\textbf{Elongation:} \enzrcpElongationCycle}}

\textbf{Elongation:} \enzrcpElongationFinal

\textbf{Storage:} \enzrcpStorage}}
